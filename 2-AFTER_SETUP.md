# 설치 직후 필요한 세팅
> 서버 설치후 필요한 포트포워딩과 외부접속 설정에 필요한 도메인.. 그 중 DDNS와
> 종단간 암호화인 **HTTPS SSL**인증서 발급 방법도 정리 되어 있습니다.
>
> 그 외에 필수는 아니지만 유용한 **VPN서버** 구축에 관해서도 짚고 넘어갑니다.

## 시놀로지를 외부망에서 사용하기
  - [정품 사용자를 위한 Synology의 QuickConnect 설정](https://www.synology.com/ko-kr/knowledgebase/SRM/help/SRM/RouterApp/internet_quickconnect)

시놀로지는 자체 기능인 QuickConnect를 이용해 편리하게 외부 접근이 가능합니다.  
하지만 속도가 느리고 다소 불안한 점이 있어서.. 대체 방법으로도 외부접속을 구현할 수 있습니다.


1. 도메인을 시놀로지에 도메인을 설치
2. **라우터의 DDNS** 을 이용한 방법
등 여러 다른 대안을 소개 해보겠습니다.

## 무료 DDNS(duckdns.org) 를 이용한 외부 접속 설정
- [클리앙 철이씨님의 무료 duckdns를 시놀로지에 등록해 봅시다](https://www.clien.net/service/board/cm_nas/9177427)

## 공유기의 DDNS를 이용한 외부 접속 설정

~~~
공유기 제조사에서는 자체 DDNS 혹은 유료 DDNS를 무료로 사용할 수 있게 제공해줍니다.
주로 ipTIME과 ASUS가 있고 링크시스와 시스코 외 여러 제조사도 제공하고 있습니다.  
이를 이용해 서버를 외부접속가능하게 설정하려면 3가지의 설정이 필요합니다.
 1. 나의 서버를 DHCP에서 고정 아이피로 할당되게 한다.
 2. 사용할 기능을 포트포워딩 한다.
 3. 나의 라우터에 도메인 혹은 DDNS를 설정한다.
 포트 포워딩은 [네트워킹과 보안지식]을 참고해주시고.. 나머지 과정은 하단에 간단하게 소개 해보겠습니다.
~~~

### 공유기에서 나의 서버를 고정아이피로 할당(내부 DHCP)
1. 서버를 외부에서 사용하기 위해 여러가지 방법 중 하나의 패턴입니다.
    - 보통의 나스는 도메인을 구매해서 지정해 줄수 있고
    - 또 지금 하는 방법처럼 라우터에 DDNS를 사용하여 도메인으로 연결하는 방법도 있습니다.
2. ~~보통은 그럴일이 잘 없지만~~ 내부 아이피가 만약 바뀌어 버리게 되면 포트 포워딩이 틀어지는 문제를 방지하기 위함입니다. (물론 포워딩 했던 아이피로 고정해서 해도 되겠죠)
3. 라우터에 DHCP, DHCP 서버 란에서 아이피 고정 혹은 수동 할당에서
4. 맥 어드레스를 이용해 기기들을 구별하고 있을 것입니다.
5. 이전에 한번이라도 라우터에 접속했던 기기들의 목록이 보일텐데..
6. 서버의 DDNS를 찾아서 지정해주고 임의의 내부 아이피를 하나 지정해줍니다.
7. 공유기 혹은 서버를 재 시작했을 때.. 내가 지정해준 내부 아이피로 잘 할당되는지 확인해주면 끝입니다.


### Reverse Proxy(역방향 프록시)
역방향 프록시는 서브도메인을 이용해 원하는 내부 포트주소로 접근하는 것을 말합니다.  
가령 예를 들어서..    
~~~
music.naver.com -> naver.com:1000
photo.naver.com -> naver.com:2000
~~~
처럼.. 실제로는 1000번과 2000번 포트로 접속해야 하는 형태를..  
서브 도메인으로 지정하여 접속하게 만드는 형태를 말합니다.  


보안의 의미보다는 여러 애플리케이션을 사용할 때 혹은 다른 사람과 나스를 사용할 때  
직접 포트 번호보다는 도메인으로 나눠서 사용하는 것이 편리하기 때문이지요.
- [클리앙 명량중년님의 시놀로지 역방향 프록시로 port 번호 없이 사용하기](https://www.clien.net/service/board/cm_nas/10938224)

### **외부망에서 접근 가능한** 시놀로지 세팅하기 절차
  - 라우터 제조사의 DDNS를 활용한 방법
    - [ASUS 공유기의 DDNS 설정 방법](https://www.noip.com/support/knowledgebase/setting-ddns-asus-router/)
    - [ipTIME 공유기의 DDNS 설정 방법](http://iptime.com/iptime/?page_id=67&pageid=1&mod=document&keyword=ddns&uid=7307)
    - 이외의 대부분의 제조사에서도 DDNS를 제공하고 있습니다. **공유기 관리자 페이지(콘솔)** 에서 확인 해보세요!
1. 제조사에서 DDNS 설정 방법에 대해 안내하고 있는 페이지들입니다.
2. 이외에 제조사에서도 제공하고 대부분 제공하고 있으니.. 공유기 페이지에서 DDNS를 찾아서 설정 해주세요.
3. DDNS 설정 확인을 위해 지인 혹은 스마트폰의 WiFi 기능을 끄고 설정한 DDNS 주소를 접속했을 때, 공유기 설정 콘솔에 접근 할 수 있다면 성공입니다!


### 포트 포워딩 + DDNS + DHCP 고정 아이피 설정이 완료 되었을 때
1. 만약 올바르게 포트 포워딩에 대해 이해하고 있다면 DDNS와 포트로 접속 했을 때.. 사용자가 포워딩한 프로그램으로 연결됩니다.
    - 서버 192.168.1.10, Webdav(5005)포트로 가정한다면
    - 내부에서 192.168.1.10:5005 로 포트로 접근했을 때 내부에서 webdav는 별다른 설정없이도 접근이 가능합니다.
    - 외부에서 webdav를 접근하기 위해서는 DDNS + 포트 포워딩 두가지의 설정이 되어 있어야합니다.
        - DDNS는 **외부망 -> 라우터** 까지의 접근을 위한 설정이며
        - 포트 포워딩은 **라우터 -> 서버** 로의 접근을 위한 설정입니다.
        - 최종적으로 **외부망 -> 라우터 -> 서버** 의 과정을 통해 외부에서 서버로 접근 합니다.
    - 만약 외부 포트(라우터) 4000을 -> (내부)192.168.1.10의 5005 포트로 포워딩 해두었다면
    - 사용자는 http://myNAS-DDNS.add.ress:4000 으로 접속을 시도 했을 때
    - 내가 포트 포워딩한 192.168.1.10의 5005 프로그램(webdav)로 포워딩 됨을 확인할 수 있습니다.
2. 이것을 이해하지 못했거나.. 생각한대로 동작하지 않는다면 **네트워킹과 보안지식** 로 다시 이동해서 숙지해주세요.
3. 내부 포트와 외부 포트를 서로 같아도 무관하지만 **보안을 위해** `외부와 내부 포트를 다르게 설정`해주세요.
    - 보통 `내부 포트는 프로토콜에서 제공`하는 **기본 포트를 그대로 사용** 하며
    - `외부 포트를 사용자가 정의`하고.. 내부에 포워딩하는 식으로 세팅하여 사용하는 것이  **보편적인 패턴**입니다.

### 도메인 & DDNS연결 후 **포트 포워딩**

~~~
시놀로지에 도메인을 연결 후에는 포트포워딩 작업을 하여야 원활하게 외부에서 여러 서비스의 접근이 가능합니다.
우리의 서버는 최상단에 라우터가 위치해 있기 때문에.. 라우터에서 포트 포워딩을 통해 원하는 애플리케이션을 호출하는 형태로 구성됩니다. 
~~~  

포트 포워딩은 라우터 -> 라우터 내 클라이언트로 포트끼리 연결해주는 개념으로 접근을 하면 조금 쉽게 이해가 가능합니다.. 라우터(공유기)세팅에서 잡아줘야 하며.. 아래 가이드를 참조해주세요.

- [RedMilk님의 Iptime공유기 포트 포워딩 설정](https://redmilk.co.kr/archives/2027)
- [Page in님의 Asus공유기 포트 포워딩 설정](https://pagein.net/asus-%EA%B3%B5%EC%9C%A0%EA%B8%B0-%ED%8F%AC%ED%8A%B8%ED%8F%AC%EC%9B%8C%EB%94%A9-port-forwarding-%EB%B0%A9%EB%B2%95/)

~~~
외부포트 -> 도메인에서 호출할 포트  
내부포트 -> 서버에서 사용하는 포트  
~~~
외부, 내부포트는 같을 수도 있지만 다를 수도 있습니다..   
가령.. 외부포트 5021, 내부포트 21.. 로컬나스IP 192.168.0.10 인
경우

http://나의도메인혹은DDNS.com:5021 -> 나의 라우터 http://192.168.0.10:21  
라고 이해하시면 됩니다.




### SSL(HTTPS)
쉽게 설명하면.. http는 평문으로 데이터를 전송하고.. https는 암호화를 하여 전송합니다.
- [Medium Noname Developer님의 시놀로지 NAS에 Let’s Encrypt 인증서 적용하기](https://medium.com/nonamedeveloper/%EC%8B%9C%EB%86%80%EB%A1%9C%EC%A7%80-nas%EC%97%90-lets-encrypt-%EC%9D%B8%EC%A6%9D%EC%84%9C-%EC%A0%81%EC%9A%A9%ED%95%98%EA%B8%B0-3d42d8f30c38)

### VPN 서버 구축
> 간단하게 VPN에 대해 알고 시놀로지에 VPN서버를 구축합니다.
PPTP , L2TP , OpenVPN , SSTP , IKEv2 )비교 장단점 ...

Virtual Private Network의 줄임말로.. 사설 가상 네트워크입니다. 즉 실제로는 같은 네트워크가 아니지만.. 가상으로 실제 같은 네트워크에 있는 것처럼.. 사용하는 것입니다. 

삼바로 유명한 SMB/CIFS 프로토콜(흔히 윈도우에서 네트워크 환경으로 접근하는..)은 내부망을 위해 만들어진 프로토콜이므로.. 외부 접근 설정이 까다로운데.. 이 VPN을 이용해 상당히 간단하게 접근이 가능합니다.

요즘은 **회사처럼 특정하게 네트워크단에서 접근을 제어하는 장소**에서 VPN으로 **우회**하는 용도.. 혹은 **공용 와이파이에서 개인정보 보호**를 용도로 사용하고 있습니다. 이는.. VPN 터널링 프로토콜 사용으로 가능합니다.

- [클리앙 o쪼꼬렛o님의 Let's Encrypt 적용된 시놀나스에 OpenVPN 설정하기](https://www.clien.net/service/board/cm_nas/12985801)

